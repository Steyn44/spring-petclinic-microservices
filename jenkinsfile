pipeline {
    agent any

    tools {
        // Ensure SonarQube Scanner is installed and named here
        sonarQubeScanner 'SonarQube Scanner'
        Maven3 'Default Maven' // This should match the Maven name configured in Jenkins Global Tools
    }
    environment {
        SONAR_HOST_URL = 'http://13.127.214.92:9000'
        SONAR_LOGIN = 'squ_888824494ba783346a9ad122748d0f5da993def0'
    }

    stages {

        

        stage('Build') {
            steps {
                // Your build commands, e.g. mvn clean install
                sh 'mvn clean compile'
            }
        }
        

  stage('SonarQube Analysis') {
    def mvn = tool 'Default Maven';
    withSonarQubeEnv() {
     sh '''
                        mvn clean verify sonar:sonar \
                            -Dsonar.projectKey=My_Java_Project_Sonar \
                            -Dsonar.projectName=My_Java_Project_Sonar
                            -Dsonar.coverage.jacoco.xmlReportPaths=target/site/jacoco/jacoco.xml
                    '''
    }
  }
       
